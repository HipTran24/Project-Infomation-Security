<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Send OTP</title>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.min.js" integrity="sha384-7qAoOXltbVP82dhxHAUje59V5r2YsVfBafyUDxEdApLPmcdhBPg1DKg1ERo0BZlK" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <style>
        body {
        background-color: #0f1624;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        color: #fff;
        }
        .verify-box {
        background-color: #1e293b;
        border-radius: 15px;
        padding: 40px;
        text-align: center;
        max-width: 400px;
        width: 100%;
        box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }
        .otp-input {
        width: 45px;
        height: 50px;
        font-size: 24px;
        text-align: center;
        margin: 0 5px;
        border-radius: 8px;
        border: 1px solid #444;
        background-color: #0f172a;
        color: #fff;
        }
        .btn-submit {
        background: linear-gradient(90deg, #7b2ff7, #f107a3);
        border: none;
        border-radius: 25px;
        padding: 12px;
        font-size: 18px;
        width: 100%;
        color: #fff;
        margin-top: 20px;
        }
        .btn-submit:hover {
        opacity: 0.9;
        }
        a {
        color: #7b8eff;
        text-decoration: none;
        }
        a:hover {
        text-decoration: underline;
        }
  </style>
</head>
<body>
     <div class="verify-box">
    <!-- Logo -->
    <div class="mb-3">
      <img src="image/techshop.png" class="logo_verify" alt="logo" style="width: 60px;">
    </div>

    <!-- Title -->
    <h4 class="mb-2">Xác nhận Email của bạn</h4>
         <p class="mb-4">Chúng tôi đã gửi mã otp đến <br>
             <strong id="emailDisplay">example@gmail.com</strong></p>

         <!-- OTP Inputs -->
    <div class="d-flex justify-content-center mb-3">
      <input type="text" maxlength="1" class="otp-input">
      <input type="text" maxlength="1" class="otp-input">
      <input type="text" maxlength="1" class="otp-input">
      <input type="text" maxlength="1" class="otp-input">
      <input type="text" maxlength="1" class="otp-input">
      <input type="text" maxlength="1" class="otp-input">
    </div>

    <!-- Submit Button -->
    <button class="btn-submit">Xác nhận</button>

    <!-- Footer -->
    <p class="mt-3" style="font-size: 14px;">
      Bạn không nhận được email? <a href="verify-otp.html">Gửi lại otp</a> hoặc <a href="register.html">Tạo tài khoản khác</a>
    </p>
  </div>
     <script>
         const inputs = document.querySelectorAll(".otp-input");
         const btnSubmit = document.querySelector(".btn-submit");
         const emailDisplay = document.getElementById("emailDisplay");

         // Lấy email từ URL
         const params = new URLSearchParams(window.location.search);
         const email = params.get("email") || "example@gmail.com";
         emailDisplay.textContent = email;

         // Điều hướng input
         inputs.forEach((input, index) => {
           input.addEventListener("input", () => {
             if (input.value.length === 1 && index < inputs.length - 1) {
               inputs[index + 1].focus();
             }
           });

           input.addEventListener("keydown", (e) => {
             if (e.key === "Backspace" && !input.value && index > 0) {
               inputs[index - 1].focus();
             }
           });
         });

         // Gửi OTP
         btnSubmit.addEventListener("click", () => {
           const otp = Array.from(inputs).map(i => i.value).join("");

           if (otp.length !== 6) {
             alert("Vui lòng nhập đủ 6 số OTP!");
             return;
           }

           fetch("http://localhost:8080/mywed/user/verify-otp", {
             method: "POST",
             headers: { "Content-Type": "application/json" },
             body: JSON.stringify({ email, otp })
           })
           .then(res => res.text())
           .then(msg => {
             if (msg.includes("thành công")) {
               alert("Xác thực thành công!");
               window.location.href = "login.html";
             } else {
               alert("OTP không hợp lệ hoặc đã hết hạn!");
             }
           })
           .catch(err => console.error(err));
         });
     </script>

</body>
</html>